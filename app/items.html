<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dota 2 Items</title>
  <link rel="stylesheet" href="resources/sidebar.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1a1a2e;
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
    }

    header {
      background: linear-gradient(135deg, #16213e, #0f3460);
      padding: 20px;
      text-align: center;
      border-bottom: 2px solid #e94560;
    }

    header h1 {
      font-size: 2rem;
      color: #e94560;
      letter-spacing: 2px;
    }

    .filters {
      display: flex;
      justify-content: center;
      gap: 12px;
      padding: 16px 20px;
      background: #16213e;
      flex-wrap: wrap;
    }

    .filters input {
      padding: 8px 16px;
      border-radius: 6px;
      border: 1px solid #0f3460;
      background: #1a1a2e;
      color: #e0e0e0;
      font-size: 0.95rem;
      width: 260px;
      outline: none;
    }

    .filters input:focus { border-color: #e94560; }

    .filter-btn {
      padding: 8px 18px;
      border-radius: 6px;
      border: 1px solid #0f3460;
      background: #1a1a2e;
      color: #e0e0e0;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s;
    }

    .filter-btn:hover { background: #0f3460; }
    .filter-btn.active { background: #e94560; border-color: #e94560; color: #fff; }

    .filter-btn.consumable.active { background: #008080; border-color: #008080; }
    .filter-btn.component.active { background: #666; border-color: #666; }
    .filter-btn.common.active { background: #aaa; border-color: #aaa; color: #111; }
    .filter-btn.rare.active { background: #5b8af7; border-color: #5b8af7; }
    .filter-btn.epic.active { background: #b369f0; border-color: #b369f0; }
    .filter-btn.artifact.active { background: #e4ae39; border-color: #e4ae39; color: #111; }
    .filter-btn.secret_shop.active { background: #27ae60; border-color: #27ae60; }

    #item-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 8px;
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .item-card {
      position: relative;
      border-radius: 6px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      border: 2px solid transparent;
      background: #16213e;
    }

    .item-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 20px rgba(233, 69, 96, 0.3);
      border-color: #e94560;
    }

    .item-card img {
      width: 100%;
      display: block;
      aspect-ratio: 88/64;
      object-fit: cover;
      background: #0f1a2e;
    }

    .item-card .item-name {
      padding: 6px;
      font-size: 0.7rem;
      text-align: center;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .item-card .gold-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      background: rgba(0,0,0,0.75);
      color: #e4ae39;
      font-size: 0.65rem;
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 4px;
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      z-index: 100;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal-overlay.open { display: flex; }

    .modal {
      background: #16213e;
      border-radius: 12px;
      max-width: 700px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid #0f3460;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }

    .modal-header {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 24px;
      border-bottom: 1px solid #0f3460;
    }

    .modal-header img {
      width: 128px;
      border-radius: 8px;
      background: #0f1a2e;
    }

    .modal-header-info h2 {
      font-size: 1.6rem;
      margin-bottom: 6px;
    }

    .modal-header-info .qual-badge {
      display: inline-block;
      padding: 3px 12px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .qual-badge.consumable { background: #008080; }
    .qual-badge.component { background: #666; }
    .qual-badge.common { background: #aaa; color: #111; }
    .qual-badge.rare { background: #5b8af7; }
    .qual-badge.epic { background: #b369f0; }
    .qual-badge.artifact { background: #e4ae39; color: #111; }
    .qual-badge.secret_shop { background: #27ae60; }

    .gold-cost {
      margin-top: 8px;
      color: #e4ae39;
      font-size: 1.1rem;
      font-weight: 700;
    }

    .modal-body { padding: 24px; }

    .stats-section {
      margin-bottom: 20px;
    }

    .stats-section h3 {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #e94560;
      margin-bottom: 12px;
      border-bottom: 1px solid #0f3460;
      padding-bottom: 6px;
    }

    .ability-block {
      background: #1a1a2e;
      border-radius: 8px;
      padding: 14px;
      margin-bottom: 10px;
    }

    .ability-block .ability-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .ability-type-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ability-type-badge.active { background: #2980b9; }
    .ability-type-badge.passive { background: #27ae60; }

    .ability-title {
      font-weight: 700;
      font-size: 0.95rem;
    }

    .ability-desc {
      font-size: 0.85rem;
      color: #bbb;
      line-height: 1.5;
      white-space: pre-line;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      background: #1a1a2e;
      border-radius: 6px;
      font-size: 0.85rem;
    }

    .stat-item .label { color: #999; }
    .stat-item .value { font-weight: 600; color: #fff; }

    .meta-row {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .meta-tag {
      display: flex;
      align-items: center;
      gap: 6px;
      background: #1a1a2e;
      padding: 6px 14px;
      border-radius: 6px;
      font-size: 0.85rem;
    }

    .meta-tag .meta-label { color: #999; }
    .meta-tag .meta-value { font-weight: 600; color: #fff; }

    .components-list {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .component-chip {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #1a1a2e;
      padding: 6px 12px;
      border-radius: 6px;
    }

    .component-chip img {
      width: 32px;
      border-radius: 4px;
      background: #0f1a2e;
    }

    .component-chip span {
      font-size: 0.8rem;
      color: #ccc;
    }

    .lore-text {
      font-style: italic;
      color: #888;
      font-size: 0.85rem;
      line-height: 1.5;
      padding: 14px;
      background: #1a1a2e;
      border-radius: 8px;
      border-left: 3px solid #e94560;
    }

    .close-btn {
      position: absolute;
      top: 16px;
      right: 20px;
      background: none;
      border: none;
      color: #999;
      font-size: 1.8rem;
      cursor: pointer;
      z-index: 101;
      line-height: 1;
    }

    .close-btn:hover { color: #e94560; }

    .modal-wrapper { position: relative; }

    .loading {
      text-align: center;
      padding: 60px;
      color: #999;
      font-size: 1.1rem;
    }

    @media (max-width: 600px) {
      .modal-header { flex-direction: column; text-align: center; }
      .modal-header img { width: 100px; }
      .stats-grid { grid-template-columns: 1fr; }
      #item-grid { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
    }

  </style>
</head>
<body>
  <div class="main-content">
  <header>
    <h1>Dota 2 Items</h1>
  </header>

  <div class="filters">
    <input type="text" id="search" placeholder="Search items...">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn consumable" data-filter="consumable">Consumable</button>
    <button class="filter-btn component" data-filter="component">Component</button>
    <button class="filter-btn common" data-filter="common">Common</button>
    <button class="filter-btn rare" data-filter="rare">Rare</button>
    <button class="filter-btn epic" data-filter="epic">Epic</button>
    <button class="filter-btn artifact" data-filter="artifact">Artifact</button>
    <button class="filter-btn secret_shop" data-filter="secret_shop">Secret Shop</button>
  </div>

  <div id="item-grid">
    <div class="loading">Loading items...</div>
  </div>

  <div class="modal-overlay" id="modal-overlay">
    <div class="modal-wrapper">
      <button class="close-btn" id="close-modal">&times;</button>
      <div class="modal" id="modal-content"></div>
    </div>
  </div>

  <script src="resources/items.js"></script>
  <script>
    const CDN = 'https://cdn.cloudflare.steamstatic.com';
    let items = [];

    function loadItems() {
      items = Object.entries(ITEMS)
        .map(([key, item]) => ({ ...item, key }))
        .filter(item => item.dname && item.cost !== null && item.cost > 0 && !item.tier && item.key !== 'courier' && item.key !== 'flying_courier')
        .sort((a, b) => a.dname.localeCompare(b.dname));
      renderGrid(items);
    }

    function qualLabel(qual) {
      const labels = {
        consumable: 'Consumable',
        component: 'Component',
        common: 'Common',
        rare: 'Rare',
        epic: 'Epic',
        artifact: 'Artifact',
        secret_shop: 'Secret Shop'
      };
      return labels[qual] || qual || '';
    }

    function renderGrid(list) {
      const grid = document.getElementById('item-grid');
      if (!list.length) {
        grid.innerHTML = '<div class="loading">No items found.</div>';
        return;
      }
      grid.innerHTML = list.map(item => `
        <div class="item-card" onclick="showItem('${item.key}')">
          <img src="${CDN}${item.img}" alt="${item.dname}" loading="lazy">
          <span class="gold-badge">${item.cost}</span>
          <div class="item-name">${item.dname}</div>
        </div>
      `).join('');
    }

    function showItem(key) {
      const item = items.find(x => x.key === key);
      if (!item) return;

      let html = `
        <div class="modal-header">
          <img src="${CDN}${item.img}" alt="${item.dname}">
          <div class="modal-header-info">
            <h2>${item.dname}</h2>
            ${item.qual ? `<span class="qual-badge ${item.qual}">${qualLabel(item.qual)}</span>` : ''}
            <div class="gold-cost">${item.cost} Gold</div>
          </div>
        </div>
        <div class="modal-body">
      `;

      // Abilities
      if (item.abilities && item.abilities.length) {
        html += `<div class="stats-section"><h3>Abilities</h3>`;
        item.abilities.forEach(ab => {
          html += `
            <div class="ability-block">
              <div class="ability-header">
                <span class="ability-type-badge ${ab.type || ''}">${ab.type || ''}</span>
                <span class="ability-title">${ab.title || ''}</span>
              </div>
              <div class="ability-desc">${ab.description || ''}</div>
            </div>
          `;
        });
        html += `</div>`;
      }

      // Attributes (only those with display field)
      const displayAttribs = (item.attrib || []).filter(a => a.display);
      if (displayAttribs.length) {
        html += `<div class="stats-section"><h3>Attributes</h3><div class="stats-grid">`;
        displayAttribs.forEach(a => {
          const formatted = a.display.replace('{value}', a.value);
          html += `<div class="stat-item"><span class="label">${formatted}</span></div>`;
        });
        html += `</div></div>`;
      }

      // Stats row: mana cost, cooldown, charges
      const metaTags = [];
      if (item.mc !== false && item.mc !== undefined) {
        metaTags.push({ label: 'Mana Cost', value: item.mc });
      }
      if (item.cd !== false && item.cd !== undefined) {
        metaTags.push({ label: 'Cooldown', value: item.cd + 's' });
      }
      if (item.charges !== false && item.charges !== undefined) {
        metaTags.push({ label: 'Charges', value: item.charges });
      }
      if (metaTags.length) {
        html += `<div class="stats-section"><h3>Stats</h3><div class="meta-row">`;
        metaTags.forEach(m => {
          html += `<div class="meta-tag"><span class="meta-label">${m.label}</span><span class="meta-value">${m.value}</span></div>`;
        });
        html += `</div></div>`;
      }

      // Components
      if (item.created && item.components && item.components.length) {
        html += `<div class="stats-section"><h3>Components</h3><div class="components-list">`;
        item.components.forEach(compKey => {
          const comp = ITEMS[compKey];
          if (comp) {
            html += `
              <div class="component-chip">
                <img src="${CDN}${comp.img}" alt="${comp.dname || compKey}">
                <span>${comp.dname || compKey}</span>
              </div>
            `;
          }
        });
        html += `</div></div>`;
      }

      // Lore
      if (item.lore) {
        html += `<div class="stats-section"><h3>Lore</h3><div class="lore-text">${item.lore}</div></div>`;
      }

      html += `</div>`;

      document.getElementById('modal-content').innerHTML = html;
      document.getElementById('modal-overlay').classList.add('open');
    }

    // Close modal
    document.getElementById('close-modal').addEventListener('click', () => {
      document.getElementById('modal-overlay').classList.remove('open');
    });
    document.getElementById('modal-overlay').addEventListener('click', (e) => {
      if (e.target === e.currentTarget) {
        document.getElementById('modal-overlay').classList.remove('open');
      }
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') document.getElementById('modal-overlay').classList.remove('open');
    });

    // Filters
    document.getElementById('search').addEventListener('input', applyFilters);
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        applyFilters();
      });
    });

    function applyFilters() {
      const query = document.getElementById('search').value.toLowerCase();
      const qual = document.querySelector('.filter-btn.active').dataset.filter;
      const filtered = items.filter(item => {
        const matchName = item.dname.toLowerCase().includes(query);
        const matchQual = qual === 'all' || item.qual === qual;
        return matchName && matchQual;
      });
      renderGrid(filtered);
    }

    loadItems();

  </script>
  </div><!-- .main-content -->
  <script src="resources/sidebar.js"></script>
</body>
</html>
