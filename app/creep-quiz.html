<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Creep Wave Timer - Dota 2</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1a1a2e;
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 220px;
      min-height: 100vh;
      background: #0f1a2e;
      border-right: 1px solid #0f3460;
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 200;
      transition: transform 0.3s;
    }

    .sidebar-brand {
      padding: 20px 16px;
      border-bottom: 2px solid #e94560;
      text-align: center;
    }

    .sidebar-brand h2 {
      font-size: 1.1rem;
      color: #e94560;
      letter-spacing: 1px;
    }

    .sidebar-brand span {
      font-size: 0.65rem;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .sidebar nav {
      padding: 12px 0;
      flex: 1;
    }

    .sidebar nav a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 20px;
      color: #888;
      text-decoration: none;
      font-size: 0.9rem;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .sidebar nav a:hover {
      color: #e0e0e0;
      background: rgba(233, 69, 96, 0.05);
    }

    .sidebar nav a.active {
      color: #e94560;
      background: rgba(233, 69, 96, 0.1);
      border-left-color: #e94560;
    }

    .sidebar nav a .nav-icon {
      width: 20px;
      text-align: center;
      font-size: 1rem;
    }

    .main-content {
      flex: 1;
      margin-left: 220px;
    }

    .sidebar-toggle {
      display: none;
      position: fixed;
      top: 12px;
      left: 12px;
      z-index: 300;
      background: #0f1a2e;
      border: 1px solid #0f3460;
      color: #e0e0e0;
      padding: 8px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.2rem;
      line-height: 1;
    }

    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 199;
    }
    .sidebar-overlay.open { display: block; }

    @media (max-width: 768px) {
      .sidebar { transform: translateX(-100%); }
      .sidebar.open { transform: translateX(0); }
      .sidebar-toggle { display: block; }
      .main-content { margin-left: 0; }
    }

    header {
      background: linear-gradient(135deg, #16213e, #0f3460);
      padding: 20px;
      text-align: center;
      border-bottom: 2px solid #e94560;
    }

    header h1 {
      font-size: 2rem;
      color: #e94560;
      letter-spacing: 2px;
    }

    /* Screens */
    .screen { display: none; }
    .screen.active { display: block; }

    #pregame-screen.active {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: calc(100vh - 72px);
      padding: 20px;
    }

    .intro-card {
      background: #16213e;
      border: 1px solid #0f3460;
      border-radius: 12px;
      padding: 40px;
      max-width: 520px;
      width: 100%;
      text-align: center;
    }

    .intro-card h2 {
      font-size: 1.5rem;
      color: #e94560;
      margin-bottom: 16px;
    }

    .intro-card p {
      color: #aaa;
      font-size: 0.9rem;
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .intro-rules {
      text-align: left;
      margin: 20px 0;
      padding: 16px;
      background: #1a1a2e;
      border-radius: 8px;
    }

    .intro-rules div {
      display: flex;
      gap: 10px;
      padding: 8px 0;
      font-size: 0.85rem;
      color: #ccc;
      border-bottom: 1px solid #0f3460;
    }

    .intro-rules div:last-child { border-bottom: none; }

    .intro-rules .rule-icon {
      color: #e94560;
      font-size: 1rem;
      min-width: 20px;
      text-align: center;
    }

    .btn-start {
      background: #e94560;
      color: #fff;
      border: none;
      padding: 14px 48px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      letter-spacing: 1px;
      transition: background 0.2s;
      margin-top: 10px;
    }

    .btn-start:hover { background: #d63651; }

    /* Game HUD */
    .game-hud {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 32px;
      padding: 12px 20px;
      background: #16213e;
      border-bottom: 1px solid #0f3460;
      flex-wrap: wrap;
    }

    .hud-item {
      text-align: center;
    }

    .hud-label {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #888;
      margin-bottom: 2px;
    }

    .hud-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: #e0e0e0;
    }

    .hud-value.accent { color: #e94560; }

    /* Game area */
    .game-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      gap: 16px;
    }

    .question-text {
      font-size: 1.1rem;
      text-align: center;
      color: #e0e0e0;
      min-height: 28px;
    }

    .question-text .team-radiant { color: #27ae60; font-weight: 700; }
    .question-text .team-dire { color: #e74c3c; font-weight: 700; }
    .question-text .lane-name { color: #e94560; font-weight: 700; }
    .question-text .point-num { color: #f1c40f; font-weight: 700; }

    .map-img-wrap {
      width: 100%;
      max-width: 500px;
    }

    .map-img-wrap img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 8px;
      border: 2px solid #0f3460;
    }

    .answer-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .answer-btn {
      padding: 12px 24px;
      background: #1a1a2e;
      border: 2px solid #0f3460;
      border-radius: 8px;
      color: #e0e0e0;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      min-width: 80px;
      text-align: center;
    }

    .answer-btn:hover { border-color: #e94560; background: rgba(233, 69, 96, 0.1); }

    .answer-btn .key-hint {
      display: inline-block;
      width: 20px;
      height: 20px;
      line-height: 20px;
      border-radius: 4px;
      background: rgba(255,255,255,0.1);
      border: 1px solid #0f3460;
      font-size: 0.7rem;
      font-weight: 700;
      color: #888;
      text-align: center;
      margin-right: 8px;
      vertical-align: middle;
    }

    .answer-btn.correct {
      background: rgba(39, 174, 96, 0.25);
      border-color: #27ae60;
      color: #2ecc71;
    }

    .answer-btn.wrong {
      background: rgba(231, 76, 60, 0.25);
      border-color: #e74c3c;
      color: #e74c3c;
    }

    .answer-btn.dimmed {
      opacity: 0.4;
    }

    .answer-btn.dimmed.correct { opacity: 1; }

    .feedback-text {
      font-size: 0.9rem;
      font-weight: 600;
      min-height: 22px;
      text-align: center;
    }

    .feedback-text.correct { color: #2ecc71; }
    .feedback-text.wrong { color: #e74c3c; }

    /* Results screen */
    #results-screen.active {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: calc(100vh - 72px);
      padding: 20px;
    }

    .results-card {
      background: #16213e;
      border: 1px solid #0f3460;
      border-radius: 12px;
      padding: 40px;
      max-width: 480px;
      width: 100%;
      text-align: center;
    }

    .results-grade {
      font-size: 4rem;
      font-weight: 800;
      color: #e94560;
      line-height: 1;
      margin-bottom: 4px;
    }

    .results-comment {
      font-size: 1rem;
      color: #aaa;
      margin-bottom: 24px;
    }

    .results-total {
      font-size: 1.1rem;
      margin-bottom: 8px;
      color: #ccc;
    }

    .results-total strong {
      color: #e94560;
      font-size: 1.4rem;
    }

    .results-time {
      font-size: 1.1rem;
      margin-bottom: 24px;
      color: #ccc;
    }

    .results-time strong {
      color: #e94560;
      font-size: 1.4rem;
    }

    .btn-replay {
      background: #e94560;
      color: #fff;
      border: none;
      padding: 12px 40px;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      letter-spacing: 1px;
      transition: background 0.2s;
    }

    .btn-replay:hover { background: #d63651; }

    /* Responsive */
    @media (max-width: 768px) {
      .game-hud { gap: 16px; }
      .map-img-wrap { max-width: 360px; }
      .question-text { font-size: 0.95rem; }
    }
  </style>
  <!-- Paste this right before your closing head tag -->
  <script type="text/javascript">
    (function (f, b) { if (!b.__SV) { var e, g, i, h; window.mixpanel = b; b._i = []; b.init = function (e, f, c) { function g(a, d) { var b = d.split("."); 2 == b.length && ((a = a[b[0]]), (d = b[1])); a[d] = function () { a.push([d].concat(Array.prototype.slice.call(arguments, 0))); }; } var a = b; "undefined" !== typeof c ? (a = b[c] = []) : (c = "mixpanel"); a.people = a.people || []; a.toString = function (a) { var d = "mixpanel"; "mixpanel" !== c && (d += "." + c); a || (d += " (stub)"); return d; }; a.people.toString = function () { return a.toString(1) + ".people (stub)"; }; i = "disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split( " "); for (h = 0; h < i.length; h++) g(a, i[h]); var j = "set set_once union unset remove delete".split(" "); a.get_group = function () { function b(c) { d[c] = function () { call2_args = arguments; call2 = [c].concat(Array.prototype.slice.call(call2_args, 0)); a.push([e, call2]); }; } for ( var d = {}, e = ["get_group"].concat( Array.prototype.slice.call(arguments, 0)), c = 0; c < j.length; c++) b(j[c]); return d; }; b._i.push([e, f, c]); }; b.__SV = 1.2; e = f.createElement("script"); e.type = "text/javascript"; e.async = !0; e.src = "undefined" !== typeof MIXPANEL_CUSTOM_LIB_URL ? MIXPANEL_CUSTOM_LIB_URL : "file:" === f.location.protocol && "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//) ? "https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js" : "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js"; g = f.getElementsByTagName("script")[0]; g.parentNode.insertBefore(e, g); } })(document, window.mixpanel || []);

    // Create an instance of the Mixpanel object
    mixpanel.init("d2037635eec79523b53dc04570a01fd9", {
        autocapture: true,
        track_pageview: true,
        record_sessions_percent: 100, //records 100% of all sessions
        record_heatmap_data: true,
    });
  </script>
</head>
<body>
  <button class="sidebar-toggle" id="sidebar-toggle">&#9776;</button>
  <div class="sidebar-overlay" id="sidebar-overlay"></div>

  <aside class="sidebar" id="sidebar">
    <div class="sidebar-brand">
      <h2>DOTA 2</h2>
      <span>Analysis</span>
    </div>
    <nav>
      <a href="index.html">
        <span class="nav-icon">&#9813;</span>
        Hero Stats
      </a>
      <a href="compare.html">
        <span class="nav-icon">&#9878;</span>
        Hero Comparison
      </a>
      <a href="lane-matchup.html">
        <span class="nav-icon">&#9876;</span>
        Lane Matchup
      </a>
      <a href="hero-trivia.html">
        <span class="nav-icon">&#9678;</span>
        Hero Trivia
      </a>
      <a href="simulator.html">
        <span class="nav-icon">&#9654;</span>
        Simulator
      </a>
      <a href="creep-quiz.html" class="active">
        <span class="nav-icon">&#9820;</span>
        Creep Wave Timer
      </a>
    </nav>
  </aside>

  <div class="main-content">
    <header>
      <h1>Creep Wave Quiz</h1>
    </header>

    <!-- Pre-game -->
    <div id="pregame-screen" class="screen active">
      <div class="intro-card">
        <h2>Creep Wave Timers</h2>
        <p>Test your knowledge of creep wave timing! Given a team, lane, and game clock time, identify which checkpoint the creep wave is at on the minimap.</p>
        <div class="intro-rules">
          <div>
            <span class="rule-icon">&#9881;</span>
            <span>10 rounds per game</span>
          </div>
          <div>
            <span class="rule-icon">&#9733;</span>
            <span>Each lane has 3 checkpoints: Tower 2, Tower 1, Wave Meet</span>
          </div>
          <div>
            <span class="rule-icon">&#9678;</span>
            <span>Pick the correct point — click a button or press 1-3</span>
          </div>
          <div>
            <span class="rule-icon">&#9876;</span>
            <span>Learn wave timings to improve your map awareness</span>
          </div>
        </div>
        <button class="btn-start" id="btn-start">Start Quiz</button>
      </div>
    </div>

    <!-- Game -->
    <div id="game-screen" class="screen">
      <div class="game-hud">
        <div class="hud-item">
          <div class="hud-label">Round</div>
          <div class="hud-value" id="hud-round">0 / 10</div>
        </div>
        <div class="hud-item">
          <div class="hud-label">Score</div>
          <div class="hud-value accent" id="hud-score">0</div>
        </div>
        <div class="hud-item">
          <div class="hud-label">Time</div>
          <div class="hud-value" id="hud-timer">0:00</div>
        </div>
      </div>

      <div class="game-area">
        <div class="question-text" id="question-text"></div>
        <div class="map-img-wrap">
          <img id="map-img" src="" alt="Minimap">
        </div>
        <div class="answer-buttons" id="answer-buttons"></div>
        <div class="feedback-text" id="feedback-text"></div>
      </div>
    </div>

    <!-- Results -->
    <div id="results-screen" class="screen">
      <div class="results-card">
        <div class="results-grade" id="results-grade"></div>
        <div class="results-comment" id="results-comment"></div>
        <div class="results-total">
          Score: <strong id="results-total">0</strong> / 10
        </div>
        <div class="results-time">
          Time: <strong id="results-time">0s</strong>
        </div>
        <button class="btn-replay" id="btn-replay">Play Again</button>
      </div>
    </div>
  </div>

  <script src="resources/creep_wave_timers.js"></script>
  <script>
    // ── Constants ──────────────────────────────────────────────────────
    const TOTAL_ROUNDS = 10;
    const FEEDBACK_DELAY = 1500;

    const TEAMS = ['radiant', 'dire'];
    const LANES = ['safelane', 'midlane', 'offlane'];
    const POINTS = ['1', '2', '3'];
    const POINT_LABELS = { '1': 'Tower 1', '2': 'Tower 2', '3': 'Wave Meet' };

    // ── State ──────────────────────────────────────────────────────────
    let round = 0;
    let score = 0;
    let answered = false;
    let currentQuestion = null;
    let feedbackTimeout = null;
    let usedCombos = [];
    let startTime = 0;
    let timerInterval = null;

    // ── DOM ────────────────────────────────────────────────────────────
    const $pregame = document.getElementById('pregame-screen');
    const $game = document.getElementById('game-screen');
    const $results = document.getElementById('results-screen');
    const $hudRound = document.getElementById('hud-round');
    const $hudScore = document.getElementById('hud-score');
    const $questionText = document.getElementById('question-text');
    const $mapImg = document.getElementById('map-img');
    const $answerButtons = document.getElementById('answer-buttons');
    const $feedback = document.getElementById('feedback-text');
    const $hudTimer = document.getElementById('hud-timer');

    // ── Screen management ─────────────────────────────────────────────
    function showScreen(screen) {
      $pregame.classList.remove('active');
      $game.classList.remove('active');
      $results.classList.remove('active');
      screen.classList.add('active');
    }

    // ── Helpers ───────────────────────────────────────────────────────
    function getMapImageSrc(team, lane) {
      return `resources/minimap/minimap-${team}-${lane}.png`;
    }

    function formatTime(totalSeconds) {
      const m = Math.floor(totalSeconds / 60);
      const s = totalSeconds % 60;
      return m + ':' + String(s).padStart(2, '0');
    }

    // ── Question generation ───────────────────────────────────────────
    function generateQuestion() {
      // Build available (team, lane) combos not yet used
      let available = [];
      for (const team of TEAMS) {
        for (const lane of LANES) {
          const key = `${team}-${lane}`;
          if (!usedCombos.includes(key)) {
            available.push({ team, lane, key });
          }
        }
      }
      // Reset if all 6 combos used
      if (available.length === 0) {
        usedCombos = [];
        for (const team of TEAMS) {
          for (const lane of LANES) {
            available.push({ team, lane, key: `${team}-${lane}` });
          }
        }
      }

      const pick = available[Math.floor(Math.random() * available.length)];
      usedCombos.push(pick.key);

      // Pick a random checkpoint as the correct answer
      const correctPoint = POINTS[Math.floor(Math.random() * POINTS.length)];
      const data = pick.team === 'radiant' ? RADIANT : DIRE;
      const delta = data[pick.lane][correctPoint];

      // Build game time: pick random wave spawn (n * 30) + delta, total < 40 min
      const maxGameTime = 40 * 60;
      const maxN = Math.floor((maxGameTime - 1 - delta) / 30);
      const n = Math.floor(Math.random() * (maxN + 1));
      const gameTime = n * 30 + delta;

      return {
        team: pick.team,
        lane: pick.lane,
        correctPoint,
        gameTime,
      };
    }

    // ── Timer ────────────────────────────────────────────────────────
    function updateTimer() {
      const elapsed = Math.round((Date.now() - startTime) / 1000);
      const m = Math.floor(elapsed / 60);
      const s = elapsed % 60;
      $hudTimer.textContent = m + ':' + (s < 10 ? '0' : '') + s;
    }

    // ── Game logic ────────────────────────────────────────────────────
    function startGame() {
      round = 0;
      score = 0;
      usedCombos = [];
      $hudScore.textContent = '0';
      startTime = Date.now();
      $hudTimer.textContent = '0:00';
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(updateTimer, 1000);
      showScreen($game);
      mixpanel.track('Creep Quiz Started');
      nextRound();
    }

    function nextRound() {
      round++;
      if (round > TOTAL_ROUNDS) {
        showResults();
        return;
      }

      answered = false;
      $hudRound.textContent = round + ' / ' + TOTAL_ROUNDS;
      $feedback.textContent = '';
      $feedback.className = 'feedback-text';

      currentQuestion = generateQuestion();
      const { team, lane, gameTime } = currentQuestion;

      const teamLabel = team.charAt(0).toUpperCase() + team.slice(1);
      const laneLabel = lane.charAt(0).toUpperCase() + lane.slice(1);

      $questionText.innerHTML =
        `<span class="team-${team}">${teamLabel}</span> ` +
        `<span class="lane-name">${laneLabel}</span> — ` +
        `At which point is the creep wave at <span class="point-num">${formatTime(gameTime)}</span>?`;

      $mapImg.src = getMapImageSrc(team, lane);

      // Render answer buttons: Tower 1, Tower 2, Wave Meet
      const BUTTON_ORDER = ['1', '2', '3'];
      $answerButtons.innerHTML = BUTTON_ORDER.map((pt, i) =>
        `<button class="answer-btn" data-point="${pt}">` +
        `<span class="key-hint">${i + 1}</span>${POINT_LABELS[pt]}</button>`
      ).join('');

      $answerButtons.querySelectorAll('.answer-btn').forEach(btn => {
        btn.addEventListener('click', () => handleAnswer(btn.dataset.point));
      });
    }

    function handleAnswer(selectedPoint) {
      if (answered || !currentQuestion) return;
      answered = true;

      const correct = selectedPoint === currentQuestion.correctPoint;

      if (correct) {
        score++;
        $hudScore.textContent = score;
        $feedback.textContent = 'Correct!';
        $feedback.className = 'feedback-text correct';
      } else {
        $feedback.textContent = `Wrong! The answer is ${POINT_LABELS[currentQuestion.correctPoint]}.`;
        $feedback.className = 'feedback-text wrong';
      }

      // Update button styles
      $answerButtons.querySelectorAll('.answer-btn').forEach(btn => {
        const pt = btn.dataset.point;
        btn.classList.add('dimmed');
        if (pt === currentQuestion.correctPoint) {
          btn.classList.add('correct');
        }
        if (pt === selectedPoint && !correct) {
          btn.classList.add('wrong');
        }
      });

      feedbackTimeout = setTimeout(() => nextRound(), FEEDBACK_DELAY);
    }

    function showResults() {
      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
      const pct = Math.round((score / TOTAL_ROUNDS) * 100);
      const elapsedMs = Date.now() - startTime;
      const elapsedSec = Math.round(elapsedMs / 1000);
      const mins = Math.floor(elapsedSec / 60);
      const secs = elapsedSec % 60;
      const timeStr = mins > 0
        ? mins + 'm ' + secs + 's'
        : secs + 's';

      let grade, comment;
      if (pct >= 90) { grade = 'S'; comment = 'Immortal-tier creep knowledge!'; }
      else if (pct >= 80) { grade = 'A'; comment = 'Divine — you know your wave timings'; }
      else if (pct >= 70) { grade = 'B'; comment = 'Ancient — solid understanding'; }
      else if (pct >= 60) { grade = 'C'; comment = 'Legend — keep practicing'; }
      else if (pct >= 50) { grade = 'D'; comment = 'Archon — room to improve'; }
      else { grade = 'F'; comment = 'Herald — the journey begins here'; }

      document.getElementById('results-grade').textContent = grade;
      document.getElementById('results-comment').textContent = comment;
      document.getElementById('results-total').textContent = score;
      document.getElementById('results-time').textContent = timeStr;

      mixpanel.track('Creep Quiz Completed', {
        'score': score,
        'total_rounds': TOTAL_ROUNDS,
        'percentage': pct,
        'grade': grade,
        'time_seconds': elapsedSec
      });

      showScreen($results);
    }

    // ── Event listeners ───────────────────────────────────────────────
    document.getElementById('btn-start').addEventListener('click', startGame);
    document.getElementById('btn-replay').addEventListener('click', () => {
      showScreen($pregame);
    });

    // Keyboard shortcuts 1-3
    document.addEventListener('keydown', (e) => {
      if (!$game.classList.contains('active') || answered) return;
      const idx = parseInt(e.key) - 1;
      if (idx < 0 || idx > 2 || isNaN(idx)) return;
      const btns = $answerButtons.querySelectorAll('.answer-btn');
      if (idx < btns.length) {
        handleAnswer(btns[idx].dataset.point);
      }
    });

    // Sidebar toggle
    document.getElementById('sidebar-toggle').addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('open');
      document.getElementById('sidebar-overlay').classList.toggle('open');
    });
    document.getElementById('sidebar-overlay').addEventListener('click', () => {
      document.getElementById('sidebar').classList.remove('open');
      document.getElementById('sidebar-overlay').classList.remove('open');
    });
  </script>
</body>
</html>
