<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hero Comparison - Dota 2</title>
  <link rel="stylesheet" href="resources/sidebar.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1a1a2e;
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
    }

    header {
      background: linear-gradient(135deg, #16213e, #0f3460);
      padding: 20px;
      text-align: center;
      border-bottom: 2px solid #e94560;
    }

    header h1 {
      font-size: 2rem;
      color: #e94560;
      letter-spacing: 2px;
    }

    /* Controls */
    .controls {
      background: #16213e;
      padding: 16px 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    .control-row {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .control-row .label {
      font-size: 0.8rem;
      color: #999;
      text-transform: uppercase;
      letter-spacing: 1px;
      min-width: 70px;
    }

    .ctrl-btn {
      padding: 8px 16px;
      border-radius: 6px;
      border: 1px solid #0f3460;
      background: #1a1a2e;
      color: #e0e0e0;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s;
    }

    .ctrl-btn:hover { background: #0f3460; }
    .ctrl-btn.active { background: #e94560; border-color: #e94560; color: #fff; }
    .ctrl-btn.meta.active { background: #f39c12; border-color: #f39c12; }

    /* Tier columns */
    .tier-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .tier-column {
      background: #16213e;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #0f3460;
    }

    .tier-header {
      padding: 10px 14px;
      text-align: center;
      font-size: 0.85rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #fff;
    }

    .tier-header.tier-top { background: #27ae60; }
    .tier-header.tier-high { background: #f39c12; }
    .tier-header.tier-mid { background: #e67e22; }
    .tier-header.tier-low { background: #c0392b; }

    .tier-body {
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .tier-card {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 5px 8px;
      background: #1a1a2e;
      border-radius: 4px;
      font-size: 0.8rem;
      transition: background 0.15s;
    }

    .tier-card:hover { background: #0f3460; }

    .tier-card img {
      width: 40px;
      height: 22px;
      object-fit: cover;
      border-radius: 3px;
      flex-shrink: 0;
    }

    .tier-card .hero-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tier-card .stat-val {
      font-weight: 600;
      color: #e94560;
      white-space: nowrap;
    }

    .loading {
      text-align: center;
      padding: 60px;
      color: #999;
      font-size: 1.1rem;
    }

    @media (max-width: 900px) {
      .tier-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 500px) {
      .tier-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="main-content">
    <header>
      <h1>Hero Comparison Tool</h1>
    </header>

    <div class="controls">
      <div class="control-row">
        <span class="label">Dimension</span>
        <button class="ctrl-btn active" data-dim="hp">HP</button>
        <button class="ctrl-btn" data-dim="mana">Mana</button>
        <button class="ctrl-btn" data-dim="armor">Base Armor</button>
        <button class="ctrl-btn" data-dim="mr">Magic Resistance</button>
        <button class="ctrl-btn" data-dim="dmg">Base Damage</button>
        <button class="ctrl-btn" data-dim="hpregen">HP Regen</button>
        <button class="ctrl-btn" data-dim="manaregen">Mana Regen</button>
        <button class="ctrl-btn" data-dim="ms">Move Speed</button>
        <button class="ctrl-btn" data-dim="atkfreq">Attacks/Sec</button>
        <button class="ctrl-btn" data-dim="range">Range</button>
      </div>
      <div class="control-row">
        <span class="label">Filter</span>
        <button class="ctrl-btn meta" id="meta-filter-btn">META</button>
      </div>
      <div class="control-row">
        <span class="label">Level</span>
        <button class="ctrl-btn level-btn active" data-level="1">1</button>
        <button class="ctrl-btn level-btn" data-level="5">5</button>
        <button class="ctrl-btn level-btn" data-level="10">10</button>
        <button class="ctrl-btn level-btn" data-level="15">15</button>
        <button class="ctrl-btn level-btn" data-level="20">20</button>
        <button class="ctrl-btn level-btn" data-level="25">25</button>
        <button class="ctrl-btn level-btn" data-level="30">30</button>
      </div>
    </div>

    <div id="results">
      <div class="loading">Loading heroes...</div>
    </div>
  </div>

  <script src="resources/heroes.js"></script>
  <script src="resources/meta.js"></script>
  <script src="resources/hero-stats.js"></script>
  <script>
    const CDN = 'https://cdn.cloudflare.steamstatic.com';
    let heroes = [];
    let selectedDim = 'hp';
    let selectedLevel = 1;
    let metaFilter = false;
    const metaHeroNames = new Set(META_ALL.flatMap(arr => arr.slice(0, 6)));

    function loadHeroes() {
      heroes = [...HEROES].sort((a, b) => a.localized_name.localeCompare(b.localized_name));
      render();
    }

    function render() {
      const pool = metaFilter ? heroes.filter(h => metaHeroNames.has(h.localized_name)) : heroes;
      const entries = pool.map(h => ({
        hero: h,
        value: calcStat(h, selectedDim, selectedLevel),
      }));

      // Sort ascending for percentile calculation
      const sorted = [...entries].sort((a, b) => a.value - b.value);
      const n = sorted.length;
      const p25 = sorted[Math.floor(n * 0.25)].value;
      const p50 = sorted[Math.floor(n * 0.50)].value;
      const p75 = sorted[Math.floor(n * 0.75)].value;

      const buckets = [[], [], [], []]; // 75-100, 50-75, 25-50, 0-25
      for (const entry of entries) {
        if (entry.value >= p75) buckets[0].push(entry);
        else if (entry.value >= p50) buckets[1].push(entry);
        else if (entry.value >= p25) buckets[2].push(entry);
        else buckets[3].push(entry);
      }

      // Sort each bucket descending
      for (const bucket of buckets) {
        bucket.sort((a, b) => b.value - a.value);
      }

      const tierMeta = [
        { label: '75 - 100', cls: 'tier-top' },
        { label: '50 - 75', cls: 'tier-high' },
        { label: '25 - 50', cls: 'tier-mid' },
        { label: '0 - 25', cls: 'tier-low' },
      ];

      const html = `<div class="tier-container">${buckets.map((bucket, i) => `
        <div class="tier-column">
          <div class="tier-header ${tierMeta[i].cls}">${tierMeta[i].label}</div>
          <div class="tier-body">
            ${bucket.map(e => `
              <div class="tier-card">
                <img src="${CDN}${e.hero.img}" alt="${e.hero.localized_name}" loading="lazy">
                <span class="hero-name">${e.hero.localized_name}</span>
                <span class="stat-val">${formatStat(e.value, selectedDim)}</span>
              </div>
            `).join('')}
          </div>
        </div>
      `).join('')}</div>`;

      document.getElementById('results').innerHTML = html;
    }

    // Dimension buttons
    document.querySelectorAll('[data-dim]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-dim]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedDim = btn.dataset.dim;
        render();
      });
    });

    // Level buttons
    document.querySelectorAll('.level-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedLevel = parseInt(btn.dataset.level);
        render();
      });
    });

    // Meta filter
    document.getElementById('meta-filter-btn').addEventListener('click', () => {
      metaFilter = !metaFilter;
      document.getElementById('meta-filter-btn').classList.toggle('active', metaFilter);
      render();
    });

    loadHeroes();
  </script>
  <script src="resources/sidebar.js"></script>
</body>
</html>
